"use strict";(self.webpackChunkresearch=self.webpackChunkresearch||[]).push([[4319],{5680:(e,a,t)=>{t.d(a,{xA:()=>l,yg:()=>u});var s=t(6540);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);a&&(s=s.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,s)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){n(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function p(e,a){if(null==e)return{};var t,s,n=function(e,a){if(null==e)return{};var t,s,n={},r=Object.keys(e);for(s=0;s<r.length;s++)t=r[s],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)t=r[s],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var m=s.createContext({}),o=function(e){var a=s.useContext(m),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},l=function(e){var a=o(e.components);return s.createElement(m.Provider,{value:a},e.children)},c="mdxType",g={inlineCode:"code",wrapper:function(e){var a=e.children;return s.createElement(s.Fragment,{},a)}},h=s.forwardRef((function(e,a){var t=e.components,n=e.mdxType,r=e.originalType,m=e.parentName,l=p(e,["components","mdxType","originalType","parentName"]),c=o(t),h=n,u=c["".concat(m,".").concat(h)]||c[h]||g[h]||r;return t?s.createElement(u,i(i({ref:a},l),{},{components:t})):s.createElement(u,i({ref:a},l))}));function u(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var r=t.length,i=new Array(r);i[0]=h;var p={};for(var m in a)hasOwnProperty.call(a,m)&&(p[m]=a[m]);p.originalType=e,p[c]="string"==typeof e?e:n,i[1]=p;for(var o=2;o<r;o++)i[o]=t[o];return s.createElement.apply(null,i)}return s.createElement.apply(null,t)}h.displayName="MDXCreateElement"},3711:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>m,contentTitle:()=>i,default:()=>g,frontMatter:()=>r,metadata:()=>p,toc:()=>o});var s=t(8168),n=(t(6540),t(5680));const r={title:"Account signatures and keys"},i=void 0,p={unversionedId:"Polkadot/security/keys/accounts",id:"Polkadot/security/keys/accounts",title:"Account signatures and keys",description:"Ristretto",source:"@site/docs/Polkadot/security/keys/1-accounts.md",sourceDirName:"Polkadot/security/keys",slug:"/Polkadot/security/keys/accounts",permalink:"/Polkadot/security/keys/accounts",draft:!1,editUrl:"https://github.com/w3f/research/blob/master/docs/Polkadot/security/keys/1-accounts.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Account signatures and keys"},sidebar:"sidebar",previous:{title:"Polkadot's keys",permalink:"/Polkadot/security/keys/"},next:{title:"Account signatures and keys in Polkadot",permalink:"/Polkadot/security/keys/accounts-more"}},m={},o=[{value:"Ristretto",id:"ristretto",level:2},{value:"Additional signature types",id:"additional-signature-types",level:2}],l={toc:o},c="wrapper";function g(e){let{components:a,...t}=e;return(0,n.yg)(c,(0,s.A)({},l,t,{components:a,mdxType:"MDXLayout"}),(0,n.yg)("h2",{id:"ristretto"},"Ristretto"),(0,n.yg)("p",null,"We believe Polkadot accounts should primarily use Schnorr signatures with both public keys and the ",(0,n.yg)("inlineCode",{parentName:"p"},"R")," point in the signature encoded using the ",(0,n.yg)("a",{parentName:"p",href:"https://ristretto.group"},"Ristretto")," point compression for the Ed25519 curve.  We should collaborate with the ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/dalek-cryptography"},"dalek ecosystem")," for which Ristretto was developed, but provide a simpler signature crate, for which ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/w3f/schnorr-dalek"},"schnorr-dalek")," provides a first step."),(0,n.yg)("p",null,"I'll write a another comment giving more details behind this choice, but the high level summary goes:"),(0,n.yg)("p",null,"Account keys must support the diverse functionality desired of account keys on other systems like Ethereum and Bitcoin.  As such, our account keys shall use Schnorr signatures because these support fast batch verification and hierarchical deterministic key derivation ala ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#Child_key_derivation_CKD_functions"},"BIP32"),". All features from the ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki"},"Bitcoin Schnorr wishlist")," provides a case for Schnorr signatures matter too, like"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"interactive threshold and multi-signatures, as well as"),(0,n.yg)("li",{parentName:"ul"},"adaptor, and perhaps even blind, signatures for swaps and payment channels. ")),(0,n.yg)("p",null,"We make conservative curve choices here because account keys must live for decades.  In particular, we avoid pairing-based cryptography and BLS signatures for accounts, at the cost of true aggregation of the signatures in a block when verifying blocks, and less interactive threshold and multi-signaturtes. ","[1]",". "),(0,n.yg)("p",null,"In the past, there was a tricky choice between the more secure curves:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"miss-implementation resistance is stronger with Edwards curves, including the Ed25519 curve, but"),(0,n.yg)("li",{parentName:"ul"},"miss-use resistance in stronger when curves have cofactor 1, like secp256k1.")),(0,n.yg)("p",null,"In fact, miss-use resistance was historically a major selling point for Ed25519, which itself is a Schnorr variant, but this miss-use resistance extends only so far as the rudimentary signature scheme properties it provided.  Yet, any advanced signature scheme functions, beyond batch verification, break precisely due to Ed25519's miss-use resistance.  In fact, there are tricks for doing at least hierarchical deterministic key derivation on Ed25519, as implemented in ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/w3f/hd-ed25519"},"hd-ed25519"),", but almost all previous efforts ",(0,n.yg)("a",{parentName:"p",href:"https://forum.web3.foundation/t/key-recovery-attack-on-bip32-ed25519/44"},"produced insecure results"),"."),(0,n.yg)("p",null,"We observe that secp256k1 provides a good curve choice from among the curves of cofactor 1, which simplify make implementing fancier protocols.  We do worry that such curves appear at least slightly weaker than Edwards curves.   We worry much more than such curves tend to be harder to implement well, due to having incomplete addition formulas, and thus require more review (see ",(0,n.yg)("a",{parentName:"p",href:"https://safecurves.cr.yp.to"},"safecurves.cr.yp.to"),").  We could select only solid implementations for Polkadot itself, but we cannot control the implementations selected elsewhere in our ecosystem, especially by wallet software."),(0,n.yg)("p",null,"In short, we want an Edwards curve but without the cofactor, which do not exist, except.."),(0,n.yg)("p",null,"In Edwards curve of with cofactor 4, ",(0,n.yg)("a",{parentName:"p",href:"https://www.shiftleft.org/papers/decaf/"},"Mike Hamburg's Decaf point compression")," only permits serialising and deserialising points on the subgroup of order ",(0,n.yg)("span",{parentName:"p",className:"math math-inline"},(0,n.yg)("span",{parentName:"span",className:"katex"},(0,n.yg)("span",{parentName:"span",className:"katex-mathml"},(0,n.yg)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,n.yg)("semantics",{parentName:"math"},(0,n.yg)("mrow",{parentName:"semantics"},(0,n.yg)("mi",{parentName:"mrow"},"l")),(0,n.yg)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"l")))),(0,n.yg)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,n.yg)("span",{parentName:"span",className:"base"},(0,n.yg)("span",{parentName:"span",className:"strut",style:{height:"0.6944em"}}),(0,n.yg)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.01968em"}},"l"))))),", which provides a perfect solution.  ",(0,n.yg)("a",{parentName:"p",href:"https://ristretto.group"},"Ristretto")," pushes this point compression to cofactor 8, making it applicable to the Ed25519 curve.  Implementations exist in both ",(0,n.yg)("a",{parentName:"p",href:"https://doc.dalek.rs/curve25519_dalek/ristretto/index.html"},"Rust")," and ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/Ristretto/libristretto255"},"C"),".  If required in another language, the compression and decompression functions are reasonable to implement using an existing field implementation, and fairly easy to audit.  "),(0,n.yg)("p",null,'In the author\'s words, "Rather than bit-twiddling, point mangling, or otherwise kludged-in ad-hoc fixes, Ristretto is a thin layer that provides protocol implementors with the correct abstraction: a prime-order group."'),(0,n.yg)("h2",{id:"additional-signature-types"},"Additional signature types"),(0,n.yg)("p",null,"We could support multiple signature schemes for accounts, preferably with each account supporting only one single signature scheme, and possessing only one public key.  There are at least three or four additional signature types worth considering:"),(0,n.yg)("p",null,"We could support Ed25519 itself so as to improve support for HSMs, etc.  It's security is no different from Ristretto Schnorr signatures for normal use cases.  We've provided a secure HDKD solution, but users might encounter problems from existing tools that provide HDKD solutions."),(0,n.yg)("p",null,"At least initially, we have allocated dots to secp256k1 keys compatible with ECDSA signatures on Ethereum.  We could use Schnorr / EdDSA signatures with these same keys instead.  We could however restrict these keys to doing only outgoing transfers, with the hope that they disappear completely without the first six months.  We might alternatively keep secp256k1 key support long term in the hopes that either the secp vs secq duality proves useful, or that parties with legacy infrastructure like exchanges benefit."),(0,n.yg)("p",null,"We might develop a delinearized variant of the proof-of-possesion based mBCJ signatures from pages 21 and 22 of ",(0,n.yg)("a",{parentName:"p",href:"https://eprint.iacr.org/2018/417.pdf"},"https://eprint.iacr.org/2018/417.pdf")," which provide two-round trip multi-signatures.  All current Schnorr multi-signature schemes require three round trips.  See ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/w3f/schnorrkel/issues/15"},"https://github.com/w3f/schnorrkel/issues/15"),"  I'd expect such a delinearized variant of mBCJ to use Ristretto keys too, but the signature scheme differs."),(0,n.yg)("p",null,"We could support BLS12-381 signatures to provide true signature aggregation.  We could even integrate these with how session keys appear on-chain, but we've currently no argument for doing this."),(0,n.yg)("hr",null),(0,n.yg)("p",null,"[1]"," Aggregation can dramatically reduce signed message size when applying numerous signatures, but if performance is the only goal then batch verification techniques similar results, and exist for mny signature schemes, including Schnorr.  There are clear advantages to reducing interactiveness in threshold and multi-signaturtes, but parachains can always provide these on Polkadot.  Importantly, there are numerous weaknesses in all known curves that support pairings, but the single most damning weakness is the pairing ",(0,n.yg)("span",{parentName:"p",className:"math math-inline"},(0,n.yg)("span",{parentName:"span",className:"katex"},(0,n.yg)("span",{parentName:"span",className:"katex-mathml"},(0,n.yg)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,n.yg)("semantics",{parentName:"math"},(0,n.yg)("mrow",{parentName:"semantics"},(0,n.yg)("mi",{parentName:"mrow"},"e"),(0,n.yg)("mo",{parentName:"mrow"},":"),(0,n.yg)("msub",{parentName:"mrow"},(0,n.yg)("mi",{parentName:"msub"},"G"),(0,n.yg)("mn",{parentName:"msub"},"1")),(0,n.yg)("mo",{parentName:"mrow"},"\xd7"),(0,n.yg)("msub",{parentName:"mrow"},(0,n.yg)("mi",{parentName:"msub"},"G"),(0,n.yg)("mn",{parentName:"msub"},"2")),(0,n.yg)("mo",{parentName:"mrow"},"\u2192"),(0,n.yg)("msub",{parentName:"mrow"},(0,n.yg)("mi",{parentName:"msub"},"G"),(0,n.yg)("mi",{parentName:"msub"},"T"))),(0,n.yg)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"e : G_1 \\times G_2 \\to G_T")))),(0,n.yg)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,n.yg)("span",{parentName:"span",className:"base"},(0,n.yg)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,n.yg)("span",{parentName:"span",className:"mord mathnormal"},"e"),(0,n.yg)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,n.yg)("span",{parentName:"span",className:"mrel"},":"),(0,n.yg)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,n.yg)("span",{parentName:"span",className:"base"},(0,n.yg)("span",{parentName:"span",className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,n.yg)("span",{parentName:"span",className:"mord"},(0,n.yg)("span",{parentName:"span",className:"mord mathnormal"},"G"),(0,n.yg)("span",{parentName:"span",className:"msupsub"},(0,n.yg)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,n.yg)("span",{parentName:"span",className:"vlist-r"},(0,n.yg)("span",{parentName:"span",className:"vlist",style:{height:"0.3011em"}},(0,n.yg)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,n.yg)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,n.yg)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,n.yg)("span",{parentName:"span",className:"mord mtight"},"1")))),(0,n.yg)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,n.yg)("span",{parentName:"span",className:"vlist-r"},(0,n.yg)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,n.yg)("span",{parentName:"span"})))))),(0,n.yg)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.yg)("span",{parentName:"span",className:"mbin"},"\xd7"),(0,n.yg)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222em"}})),(0,n.yg)("span",{parentName:"span",className:"base"},(0,n.yg)("span",{parentName:"span",className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,n.yg)("span",{parentName:"span",className:"mord"},(0,n.yg)("span",{parentName:"span",className:"mord mathnormal"},"G"),(0,n.yg)("span",{parentName:"span",className:"msupsub"},(0,n.yg)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,n.yg)("span",{parentName:"span",className:"vlist-r"},(0,n.yg)("span",{parentName:"span",className:"vlist",style:{height:"0.3011em"}},(0,n.yg)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,n.yg)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,n.yg)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,n.yg)("span",{parentName:"span",className:"mord mtight"},"2")))),(0,n.yg)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,n.yg)("span",{parentName:"span",className:"vlist-r"},(0,n.yg)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,n.yg)("span",{parentName:"span"})))))),(0,n.yg)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,n.yg)("span",{parentName:"span",className:"mrel"},"\u2192"),(0,n.yg)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,n.yg)("span",{parentName:"span",className:"base"},(0,n.yg)("span",{parentName:"span",className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,n.yg)("span",{parentName:"span",className:"mord"},(0,n.yg)("span",{parentName:"span",className:"mord mathnormal"},"G"),(0,n.yg)("span",{parentName:"span",className:"msupsub"},(0,n.yg)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,n.yg)("span",{parentName:"span",className:"vlist-r"},(0,n.yg)("span",{parentName:"span",className:"vlist",style:{height:"0.3283em"}},(0,n.yg)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,n.yg)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,n.yg)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,n.yg)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.13889em"}},"T")))),(0,n.yg)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,n.yg)("span",{parentName:"span",className:"vlist-r"},(0,n.yg)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,n.yg)("span",{parentName:"span"}))))))))))," itself.    In essence, we use elliptic curves in the first palce because they insulate us somewhat from mathematicians ever advancing understanding of number theory.  Yet, any known pairing maps into a group ",(0,n.yg)("span",{parentName:"p",className:"math math-inline"},(0,n.yg)("span",{parentName:"span",className:"katex"},(0,n.yg)("span",{parentName:"span",className:"katex-mathml"},(0,n.yg)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,n.yg)("semantics",{parentName:"math"},(0,n.yg)("mrow",{parentName:"semantics"},(0,n.yg)("msub",{parentName:"mrow"},(0,n.yg)("mi",{parentName:"msub"},"G"),(0,n.yg)("mi",{parentName:"msub"},"T"))),(0,n.yg)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"G_T")))),(0,n.yg)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,n.yg)("span",{parentName:"span",className:"base"},(0,n.yg)("span",{parentName:"span",className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,n.yg)("span",{parentName:"span",className:"mord"},(0,n.yg)("span",{parentName:"span",className:"mord mathnormal"},"G"),(0,n.yg)("span",{parentName:"span",className:"msupsub"},(0,n.yg)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,n.yg)("span",{parentName:"span",className:"vlist-r"},(0,n.yg)("span",{parentName:"span",className:"vlist",style:{height:"0.3283em"}},(0,n.yg)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,n.yg)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,n.yg)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,n.yg)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.13889em"}},"T")))),(0,n.yg)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,n.yg)("span",{parentName:"span",className:"vlist-r"},(0,n.yg)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,n.yg)("span",{parentName:"span"}))))))))))," that re-exposes us, so attacks based on index-calculus, etc. improve more quickly.  As a real world example, there were weaknesses found in BN curve of the sort used by ZCash during development, so after launch they needed to develop and migrate to a ",(0,n.yg)("a",{parentName:"p",href:"https://z.cash/blog/new-snark-curve/"},"new curve"),".  We expect this to happen again for roughly the same reasons that RSA key sizes increase slowly over time."))}g.isMDXComponent=!0}}]);