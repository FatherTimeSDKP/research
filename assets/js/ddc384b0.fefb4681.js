"use strict";(self.webpackChunkresearch=self.webpackChunkresearch||[]).push([[9402],{3905:(e,t,a)=>{a.d(t,{Zo:()=>l,kt:()=>k});var s=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,s,n=function(e,t){if(null==e)return{};var a,s,n={},r=Object.keys(e);for(s=0;s<r.length;s++)a=r[s],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)a=r[s],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=s.createContext({}),m=function(e){var t=s.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},l=function(e){var t=m(e.components);return s.createElement(p.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},u=s.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,p=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),c=m(a),u=n,k=c["".concat(p,".").concat(u)]||c[u]||h[u]||r;return a?s.createElement(k,o(o({ref:t},l),{},{components:a})):s.createElement(k,o({ref:t},l))}));function k(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,o=new Array(r);o[0]=u;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[c]="string"==typeof e?e:n,o[1]=i;for(var m=2;m<r;m++)o[m]=a[m];return s.createElement.apply(null,o)}return s.createElement.apply(null,a)}u.displayName="MDXCreateElement"},6869:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>m});var s=a(7462),n=(a(7294),a(3905));const r={title:"Polkadot's keys"},o=void 0,i={unversionedId:"Polkadot/security/keys/index",id:"Polkadot/security/keys/index",title:"Polkadot's keys",description:"Authors: Jeff Burdges",source:"@site/docs/Polkadot/security/keys/index.md",sourceDirName:"Polkadot/security/keys",slug:"/Polkadot/security/keys/",permalink:"/Polkadot/security/keys/",draft:!1,editUrl:"https://github.com/w3f/research/blob/main/docs/docs/Polkadot/security/keys/index.md",tags:[],version:"current",frontMatter:{title:"Polkadot's keys"},sidebar:"sidebar",previous:{title:"Security",permalink:"/Polkadot/security/"},next:{title:"Account signatures and keys",permalink:"/Polkadot/security/keys/accounts"}},p={},m=[{value:"Account keys",id:"account-keys",level:2},{value:"Session keys",id:"session-keys",level:2},{value:"old",id:"old",level:2}],l={toc:m},c="wrapper";function h(e){let{components:t,...a}=e;return(0,n.kt)(c,(0,s.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Authors"),": ",(0,n.kt)("a",{parentName:"p",href:"/team_members/jeff"},"Jeff Burdges")),(0,n.kt)("p",null,"In polkadot, we necessarily distinguish among different permissions and functionalities with different keys and key types, respectively.  We roughly categories these into account keys with which users interact and session keys that nodes manage without operator intervention beyond the certification process."),(0,n.kt)("h2",{id:"account-keys"},"Account keys"),(0,n.kt)("p",null,"Account keys have an associated balance of which portions can be ",(0,n.kt)("em",{parentName:"p"},"locked")," to play roles in staking, resource rental, and governance, including waiting out some unlocking period.  We allow several locks of varying durations, both because these roles impose different restrictions, and for multiple unlocking periods running concurrently."),(0,n.kt)("p",null,"We encourage active participation in all these roles, but they all require occasional signatures from accounts.  At the same time, account keys have better physical security when kept in inconvenient locations, like safety deposit boxes, which makes signing arduous.  We avoid this friction for users as follows."),(0,n.kt)("p",null,"Accounts declare themselves to be ",(0,n.kt)("em",{parentName:"p"},"stash accounts")," when locking funds for staking.  All stash accounts register a certificate on-chain that delegates all validator operation and nomination powers to some ",(0,n.kt)("em",{parentName:"p"},"controller account"),", and also designates some ",(0,n.kt)("em",{parentName:"p"},"proxy key")," for governance votes.  In this state, the controller and proxy accounts can sign for the stash account in staking and governance functions, respectively, but not transfer fund."),(0,n.kt)("p",null,"As a result, the stash account's locked funds can benefit from maximum physical security, while still actively participating via signatures from their controller or proxy account keys.  At anytime the stash account can replace its controller or proxy account keys, such as if operational security mistakes might've compromised either."),(0,n.kt)("p",null,"At present, we suport both ed25519 and schnorrkel/sr25519 for account keys.  These are both Schnorr-like signatures implemented using the Ed25519 curve, so both offer extremely similar security.  We recommend ed25519 keys for users who require HSM support or other external key management solution, while schnorrkel/sr25519 provides more blockchain-friendly functionality like HDKD and multi-signatures."),(0,n.kt)("p",null,"In particular, schnorrkel/sr25519 uses the ",(0,n.kt)("a",{parentName:"p",href:"https://doc.dalek.rs/curve25519_dalek/ristretto/index.html"},"Ristretto")," implementation of section 7 of Mike Hamburg's ",(0,n.kt)("a",{parentName:"p",href:"https://eprint.iacr.org/2015/673.pdf"},"Decaf")," paper, which provide the 2-torsion free points of the Ed25519 curve as a prime order group.  Avoiding the cofactor like this means Ristretto makes implementing more complex protocols significantly safer.  We employ Blake2b for most conventional hashing in polkadot, but schnorrkel/sr25519 itself uses the ",(0,n.kt)("a",{parentName:"p",href:"https://doc.dalek.rs/merlin/index.html"},"merlin")," limited implementation of Mike Hamberg's ",(0,n.kt)("a",{parentName:"p",href:"http://strobe.sourceforge.io/"},"STROBE"),", which is based on Keccak-f(1600) and provides a hashing interface well suited to signatures and NIZKs.  See ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/w3f/schnorrkel/blob/master/annoucement.md"},"https://github.com/w3f/schnorrkel/blob/master/annoucement.md")," for more detailed design notes."),(0,n.kt)("h2",{id:"session-keys"},"Session keys"),(0,n.kt)("p",null,"Session keys each fill roughly one particular role in consensus or security.  All session keys gain their authority from a session certificate that is signed by some controller key and that delegates appropriate stake."),(0,n.kt)("p",null,"At any time, the controller key can pause or revoke this session certificate and/or issue replacement with new session keys.  All new session keys can be registered in advance, and some must be, so validators can cleanly transition to new hardware by issuing session certificates that only become valid after some future session.  We suggest using pause for emergency maintenance and using revocation if a session key might be compromised."),(0,n.kt)("p",null,'We suggest session keys remain tied to one physical machine, so validator operators issue the session certificate using the RPC protocol, not handle the session secret keys themselves.   In particular, we caution against duplicating session secret keys across machines because such "high availability" designs invariably gets validator operators slashed.  Anytime new validator hardware must be started quickly the operator should first start the new node, and then certify the new session keys it creates using the RPC protocol.'),(0,n.kt)("p",null,"We impose no prior restrictions on the cryptography employed by specific substrate modules or associated session keys types."),(0,n.kt)("p",null,"In BABE, validators use schnorrkel/sr25519 keys both for a verifiable random function (VRF) based on on ",(0,n.kt)("a",{parentName:"p",href:"https://eprint.iacr.org/2017/099.pdf"},"NSEC5"),", as well as for regular Schnorr signatures."),(0,n.kt)("p",null,"A VRF is the public-key analog of a pseudo-random function (PRF), aka cryptographic hash function with a distinguished key, such as many MACs.  We award block productions slots when the block producer scores a low enough VRF output ",(0,n.kt)("span",{parentName:"p",className:"math math-inline"},(0,n.kt)("span",{parentName:"span",className:"katex"},(0,n.kt)("span",{parentName:"span",className:"katex-mathml"},(0,n.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,n.kt)("semantics",{parentName:"math"},(0,n.kt)("mrow",{parentName:"semantics"},(0,n.kt)("mrow",{parentName:"mrow"},(0,n.kt)("mi",{parentName:"mrow",mathvariant:"monospace"},"V"),(0,n.kt)("mi",{parentName:"mrow",mathvariant:"monospace"},"R"),(0,n.kt)("mi",{parentName:"mrow",mathvariant:"monospace"},"F")),(0,n.kt)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,n.kt)("msub",{parentName:"mrow"},(0,n.kt)("mi",{parentName:"msub"},"r"),(0,n.kt)("mi",{parentName:"msub"},"e")),(0,n.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2223"),(0,n.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2223"),(0,n.kt)("mrow",{parentName:"mrow"},(0,n.kt)("mi",{parentName:"mrow",mathvariant:"monospace"},"s"),(0,n.kt)("mi",{parentName:"mrow",mathvariant:"monospace"},"l"),(0,n.kt)("mi",{parentName:"mrow",mathvariant:"monospace"},"o"),(0,n.kt)("msub",{parentName:"mrow"},(0,n.kt)("mi",{parentName:"msub",mathvariant:"monospace"},"t"),(0,n.kt)("mi",{parentName:"msub",mathvariant:"monospace"},"n")),(0,n.kt)("mi",{parentName:"mrow",mathvariant:"monospace"},"u"),(0,n.kt)("mi",{parentName:"mrow",mathvariant:"monospace"},"m"),(0,n.kt)("mi",{parentName:"mrow",mathvariant:"monospace"},"b"),(0,n.kt)("mi",{parentName:"mrow",mathvariant:"monospace"},"e"),(0,n.kt)("mi",{parentName:"mrow",mathvariant:"monospace"},"r")),(0,n.kt)("mo",{parentName:"mrow",stretchy:"false"},")")),(0,n.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\mathtt{VRF}(r_e || \\mathtt{slot_number} )")))),(0,n.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,n.kt)("span",{parentName:"span",className:"base"},(0,n.kt)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,n.kt)("span",{parentName:"span",className:"mord"},(0,n.kt)("span",{parentName:"span",className:"mord mathtt"},"VRF")),(0,n.kt)("span",{parentName:"span",className:"mopen"},"("),(0,n.kt)("span",{parentName:"span",className:"mord"},(0,n.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,n.kt)("span",{parentName:"span",className:"msupsub"},(0,n.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,n.kt)("span",{parentName:"span",className:"vlist-r"},(0,n.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,n.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"-0.0278em",marginRight:"0.05em"}},(0,n.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,n.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,n.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"e")))),(0,n.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,n.kt)("span",{parentName:"span",className:"vlist-r"},(0,n.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,n.kt)("span",{parentName:"span"})))))),(0,n.kt)("span",{parentName:"span",className:"mord"},"\u2223\u2223"),(0,n.kt)("span",{parentName:"span",className:"mord"},(0,n.kt)("span",{parentName:"span",className:"mord mathtt"},"slo"),(0,n.kt)("span",{parentName:"span",className:"mord"},(0,n.kt)("span",{parentName:"span",className:"mord mathtt"},"t"),(0,n.kt)("span",{parentName:"span",className:"msupsub"},(0,n.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,n.kt)("span",{parentName:"span",className:"vlist-r"},(0,n.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,n.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,n.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,n.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,n.kt)("span",{parentName:"span",className:"mord mathtt mtight"},"n")))),(0,n.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,n.kt)("span",{parentName:"span",className:"vlist-r"},(0,n.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,n.kt)("span",{parentName:"span"})))))),(0,n.kt)("span",{parentName:"span",className:"mord mathtt"},"umber")),(0,n.kt)("span",{parentName:"span",className:"mclose"},")"))))),", so anyone with the VRF public keys can verify that blocks were produced in the correct slot, but only the block producers know their slots in advance via their VRF secret key."),(0,n.kt)("p",null,"As in ",(0,n.kt)("a",{parentName:"p",href:"https://eprint.iacr.org/2017/573.pdf"},"Ouroboros Praos"),", we provide a source of randomness ",(0,n.kt)("span",{parentName:"p",className:"math math-inline"},(0,n.kt)("span",{parentName:"span",className:"katex"},(0,n.kt)("span",{parentName:"span",className:"katex-mathml"},(0,n.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,n.kt)("semantics",{parentName:"math"},(0,n.kt)("mrow",{parentName:"semantics"},(0,n.kt)("msub",{parentName:"mrow"},(0,n.kt)("mi",{parentName:"msub"},"r"),(0,n.kt)("mi",{parentName:"msub"},"e"))),(0,n.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"r_e")))),(0,n.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,n.kt)("span",{parentName:"span",className:"base"},(0,n.kt)("span",{parentName:"span",className:"strut",style:{height:"0.5806em",verticalAlign:"-0.15em"}}),(0,n.kt)("span",{parentName:"span",className:"mord"},(0,n.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,n.kt)("span",{parentName:"span",className:"msupsub"},(0,n.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,n.kt)("span",{parentName:"span",className:"vlist-r"},(0,n.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,n.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"-0.0278em",marginRight:"0.05em"}},(0,n.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,n.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,n.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"e")))),(0,n.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,n.kt)("span",{parentName:"span",className:"vlist-r"},(0,n.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,n.kt)("span",{parentName:"span"}))))))))))," for the VRF inputs by hashing together all VRF outputs form the previous session, which requires that BABE keys be registered at least one full session before being used."),(0,n.kt)("p",null,"We reduce VRF output malleability by hashing the signer's public key along side the input, which dramatically improves security when used with HDKD.  We also hash the VRF input and output together when providing output used elsewhere, which improves compossibility in security proofs. See the 2Hash-DH construction from Theorem 2 on page 32 in appendix C of ",(0,n.kt)("a",{parentName:"p",href:"https://eprint.iacr.org/2017/573.pdf"},'"Ouroboros Praos: An adaptively-secure, semi-synchronous proof-of-stake blockchain"'),"."),(0,n.kt)("p",null,"In GRANDPA, validators shall vote using BLS signatures, which supports convenient signature aggregation and select ZCash's BLS12-381 curve for performance.  There is a risk that BLS12-381 might drops significantly below 128 bits of security, due to number field sieve advancements.  If and when this happens, we expect upgrading GRANDPA to another curve to be straightforward.  See also ",(0,n.kt)("a",{parentName:"p",href:"https://mailarchive.ietf.org/arch/msg/cfrg/eAn3_8XpcG4R2VFhDtE_pomPo2Q"},"https://mailarchive.ietf.org/arch/msg/cfrg/eAn3_8XpcG4R2VFhDtE_pomPo2Q")),(0,n.kt)("p",null,"We treat libp2p's transport keys roughly like session keys too, but they include the transport keys for sentry nodes, not just for the validator itself.  As such, the operator interacts slightly more with these."),(0,n.kt)("h2",{id:"old"},"old"),(0,n.kt)("p",null,'In this post, we shall first give a high level view of the various signing keys planned for use in Polkadot.  We then turn the discussion towards the certificate chain that stretches between staked account keys and the session keys used for our proof-of-stake design.  In other words, we aim to lay out the important questions on the "glue" between keys rolls here, but first this requires introducing the full spectrum of key rolls.'),(0,n.kt)("p",null,"We have roughly four cryptographic layers in Polkadot:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/Polkadot/security/keys/accounts"},(0,n.kt)("em",{parentName:"a"},"Account keys"))," are owned by users and tied to one actual dot denominated account on Polkadot.  Accounts could be staked/bonded, unstaked/unbonded, or unstaking/unbonding, but only an unstaked/unbonded account key can transfer dots from one account to another.  (",(0,n.kt)("a",{parentName:"li",href:"/Polkadot/security/keys/accounts-more"},"more"),")"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/Polkadot/security/keys/staking"},(0,n.kt)("em",{parentName:"a"},"Nomination"))," provide a certificate chain between staked/bonded account keys and the session keys used by nodes in block production or validating.  As nominator keys cannot transfer dots, they insulate account keys, which may remain air gapped, from nodes actually running on the internet."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/Polkadot/security/keys/session"},(0,n.kt)("em",{parentName:"a"},"Session keys"))," are actually several keys kept together that provide the various signing functions required by validators, including a couple types of verifiable random function (VRF) keys."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://forum.web3.foundation/t/transport-layer-authentication-libp2ps-secio/69"},(0,n.kt)("em",{parentName:"a"},"Transport layer static keys"))," are used by libp2p to authenticate connections between nodes.  We shall either certify these with the session key or perhaps include them directly in the session key.")))}h.isMDXComponent=!0}}]);